
# Сервис одноразовых секретов

REST API для безопасного хранения и одноразовой передачи конфиденциальной информации.

Сервис позволяет создавать защищенные паролем секреты и получать уникальный код доступа для их однократного просмотра.

## Возможности

- Создание секрета с защитой паролем
- Генерация уникального кода доступа
- Однократный просмотр секрета с последующим автоматическим удалением
- Интерактивная документация API (Swagger/OpenAPI)

***

## Архитектура

**Unit of Work (UoW)** — паттерн, инкапсулирующий операции с базой данных в рамках одного запроса. Обеспечивает упрощенное управление транзакциями и откатами при возникновении ошибок.

**Repository Pattern** — паттерн для абстракции доступа к данным. Репозитории скрывают детали работы с ORM, что упрощает замену реализации и написание тестов.

## Быстрый старт

### Запуск через Docker

1. Клонирование репозитория:

```bash
git clone https://github.com/BagRoman01/fastapi_secrets.git
cd fastapi_secrets
```

2. Создание файла окружения `.env` (см. пример ниже).

3. Сборка и запуск сервиса:

```bash
- make build
- make up
```

4. Доступ к документации API:

   Swagger UI: http://localhost:8000/docs

***

## Конфигурация

### Переменные окружения (`.env`)

```env
# DATABASE
DATABASE_HOST=postgres
DATABASE_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=test_db

# FRONTEND COMMUNICATION
CORS_ORIGINS=["http://localhost:3000","http://PRODUCTION.example.com"]

# DEPLOYMENT
HOST=127.0.0.1
PORT=8000
```

***

## Структура Docker Compose

- `postgres` — PostgreSQL 15 
- `secrets` — FastAPI-приложение (Python 3.12)

***

## Документация API

### Создание секрета

**Endpoint:** `POST /generate`

Создает одноразовый секрет и возвращает уникальный идентификатор для доступа.

#### Ограничения

**Секрет:**
- Длина: 1–65536 символов
- Поддерживаются любые текстовые данные

**Пароль (опционально):**
- Длина: 3–64 символа
- Используется для дополнительной защиты

#### Пример запроса

```json
{
  "secret": "secret",
  "password": "your_pwd"
}
```

#### Пример ответа

```json
{
  "reg_date": "2025-07-26T18:33:42.099375",
  "id": "260b98ba-4b80-45e3-ab5f-7f5f6f16bd4b"
}
```

***

### Получение секрета

**Endpoint:** `POST /unlock/{id}`

Позволяет однократно прочитать секрет по его идентификатору. После получения секрет автоматически удаляется.

#### Пример запроса

```json
{
  "id": "260b98ba-4b80-45e3-ab5f-7f5f6f16bd4b",
  "password": "your_pwd"
}
```

#### Пример ответа

```json
{
  "reg_date": "2025-07-26T18:33:42.099375",
  "secret": "secret"
}
```

#### Обработка ошибок

**Повторный доступ** (404 Not Found):

Секрет уже был просмотрен и удален из системы.

```json
{
  "errors": "Secret with this id was not found!"
}
```

**Неверный пароль** (403 Forbidden):

Указан некорректный пароль для доступа к секрету.

```json
{
  "errors": "Wrong password for the secret!"
}
```





